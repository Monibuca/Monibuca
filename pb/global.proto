syntax = "proto3";
import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
package m7s;
option go_package="m7s.live/m7s/v5/pb";

service Global {
  rpc Shutdown (RequestWithId) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/api/shutdown/{id}"
    };
  }
  rpc Restart (RequestWithId) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/api/restart/{id}"
    };
  }
  rpc StreamList (StreamListRequest) returns (StreamListResponse) {
    option (google.api.http) = {
      get: "/api/stream/list"
    };
  }
  rpc StreamSnap (StreamSnapRequest) returns (StreamSnapShot) {
    option (google.api.http) = {
      get: "/api/stream/snap/{streamPath=**}"
    };
  }
  rpc StopSubscribe (StopSubscribeRequest) returns (StopSubscribeResponse) {
    option (google.api.http) = {
      post: "/api/stop/subscribe/{id}"
      body: "*"
    };
  }
}
message StreamInfo {
    string path = 1;
}
message StreamListRequest {

}
message StreamListResponse {
  repeated StreamInfo list = 1;
}

message StreamSnapRequest {
  string streamPath = 1;
}

message Wrap {
  uint32 timestamp = 1;
  uint32 size = 2;
  string data = 3;
}

message TrackSnapShot {
  uint32 sequence = 1;
  uint32 timestamp = 2;
  uint64 writeTime = 3;
  bool canRead = 4;
  Wrap wrap = 5;
}

message StreamSnapShot {
  repeated TrackSnapShot videoTrack = 1;
  repeated TrackSnapShot audioTrack = 2;
}

message StopSubscribeRequest {
  uint32 id = 1;
}

message StopSubscribeResponse {
  bool success = 1;
}

message RequestWithId {
  uint32 id = 1;
}