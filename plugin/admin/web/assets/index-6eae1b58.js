import{d as y,e as _,w as T,U as p,_ as C,$ as f,f as s,u as t,E,k as v,V,a8 as g,a3 as w,X as I}from"./vue-14860272.js";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang-fe275800.js";import{d as h}from"./dayjs-4778c158.js";import{a9 as N,ag as H,af as j,J as R}from"./index-6c19eff1.js";import{g as z,i as A}from"./gb28281-bff8df35.js";import{u as K}from"./index-79686afe.js";import{u as Y,a as U,d as S,R as F,V as G}from"./usePlay-01e6fc4d.js";import{R as $}from"./RadioButton-fd725ab6.js";import"./index-d5a0e3f9.js";import{R as J}from"./Group-8793f768.js";import{C as b}from"./Card-2e616ea4.js";import"./device-0496f41d.js";import"./index-e5fa243b.js";import"./index-76e38462.js";import"./eagerComputed-49254c56.js";import"./index-91084da8.js";import"./mockjs-890b569b.js";import"./useModal-1fa44c95.js";import"./index-b761c39b.js";import"./jb4-8326f710.js";import"./index-7743fdb9.js";import"./useFlexGapSupport-6710d548.js";const L=y({__name:"list",props:{data:{type:Array,default:[]}},setup(D){const l=D,c=Y(),n=_(()=>c.getCurrentChannel),a=K(),r={height:"auto",rowConfig:{keyField:"StartTime",useKey:!0},columnConfig:{useKey:!0},columns:[{field:"DeviceID",title:"通道编号",showOverflow:"tooltip"},{field:"Name",title:"名称"},{field:"Address",title:"地址",showOverflow:"tooltip"},{field:"StartTime",title:"录像开始时间",formatter:({cellValue:o})=>h(o).format("YYYY-MM-DD HH:ss:mm")},{field:"EndTime",title:"录像结束时间",formatter:({cellValue:o})=>h(o).format("YYYY-MM-DD HH:ss:mm")},{field:"any",title:"录像时长",formatter:({row:o})=>{const{StartTime:m,EndTime:u}=o;return`${h(u).diff(h(m),"minutes")} 分钟`}},{field:"operate",title:"操作",width:"70px",slots:{default:"operate"},align:"center",fixed:"right"}],data:l.data};return T(()=>l.data,()=>{var o,m,u;(o=l.data)!=null&&o.length?(m=a==null?void 0:a.tableRef)==null||m.loadData(l.data):(u=a==null?void 0:a.tableRef)==null||u.loadData([])}),(o,m)=>(p(),C(t(H),{uid:t(a).uid,gridOptions:t(r)},{operate:f(({row:u})=>[s(t(N),{size:"small",type:"link",onClick:()=>t(U)({row:u,channel:t(n)})},{default:f(()=>[E(" 播放 ")]),_:2},1032,["onClick"])]),_:1},8,["uid","gridOptions"]))}}),X={class:"h-full"},q={class:"flex justify-between mb-16px"},Q=g("span",null," 时间轴视图",-1),W=g("span",null," 列表视图",-1),Z=y({__name:"content",setup(D){const l=Y(),c=_(()=>l.getCurrentChannel),n=_(()=>l.getTimeRange),a=v("video"),r=v(),o=v(),m=e=>{if(!r.value||r.value.length===0)return!1;const i=r.value[0]&&e.diff(r.value[0],"days")>2;return r.value[1]&&r.value[1].diff(e,"days")>2||i},u=e=>{e?(r.value=[],o.value=[]):o.value=void 0},M=e=>{r.value=e},P=e=>{l.setTimeRange(e)},k=_(()=>`${c.value.ID}/${c.value.DeviceID}`),x=v([]);T([()=>{var e;return(e=l.getCurrentChannel)==null?void 0:e.key},()=>n.value],()=>{const{ID:e,DeviceID:i}=c.value;e&&i&&z({id:e,channel:i,range:`${S(n.value[0],"YYYY-MM-DD 00:00:00")}-${S(n.value[1],"YYYY-MM-DD 24:00:00")}`}).then(d=>{x.value=d,d!=null&&d.length?B():j.warn("当前无可播放的录像！！！")}).catch(d=>{console.error(`getRecords-error: ${d}`)})});const B=()=>{const{ID:e,DeviceID:i}=c.value;A({id:e,channel:i})};return(e,i)=>(p(),V("div",X,[g("div",q,[s(t(F),{value:o.value||t(n),disabledDate:m,onOpenChange:u,onChange:P,onCalendarChange:M,allowClear:!1},null,8,["value"]),s(t(J),{value:a.value,"onUpdate:value":i[0]||(i[0]=d=>a.value=d)},{default:f(()=>[s(t($),{value:"video"},{default:f(()=>[s(t(R),{icon:"mdi:timeline-clock-outline",class:"v-text-bottom"}),Q]),_:1}),s(t($),{value:"list"},{default:f(()=>[s(t(R),{icon:"pixelarticons:list-box",class:"v-text-bottom"}),W]),_:1})]),_:1},8,["value"])]),g("div",{class:"w-full",style:I({height:"calc(100% - 32px)"})},[a.value==="video"?(p(),C(G,{data:x.value,streamPathPre:t(k),key:t(k)},null,8,["data","streamPathPre"])):w("",!0),a.value==="list"?(p(),C(L,{key:1,data:x.value},null,8,["data"])):w("",!0)],4)]))}}),ee=y({name:"Record"}),Ye=y({...ee,setup(D){const l=Y(),c=n=>{l.setCurrentChannel(n)};return(n,a)=>(p(),V("div",{class:"flex",style:I({height:"calc(100% - 8px)"})},[s(t(b),{class:"w-342px m-r-8px flex-shrink-0",bordered:!1,bodyStyle:{height:"100%",padding:0}},{default:f(()=>[s(O,{onSelect:c,single:""})]),_:1}),s(t(b),{class:"flex-1",bordered:!1,bodyStyle:{height:"100%",padding:"16px"}},{default:f(()=>[s(Z)]),_:1})],4))}});export{Ye as default};
