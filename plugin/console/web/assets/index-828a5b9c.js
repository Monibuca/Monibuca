import{l as g}from"./vendor-ec30964e.js";import{e as T,f as S}from"./index-cc631905.js";import{s as o}from"./index-de28ae1e.js";import{_ as C}from"./index-eabbb46f.js";import{_ as x}from"./index-c14b60e2.js";const D=n=>(Vue.pushScopeId("data-v-74a4cd9b"),n=n(),Vue.popScopeId(),n),E={class:"page"},y={class:"title"},F={class:"title"},B=D(()=>Vue.createElementVNode("br",null,null,-1)),$={class:"title"},G={class:"title"},P={class:"title"},j=["srcObject"],I=Vue.defineComponent({setup(n){const h=naive.useMessage();function f(u){return u=u<<3,u>1024*1024?(u/1024/1024).toFixed(2)+" mb/s":u>1024?(u/1024).toFixed(2)+" kb/s":u.toString()+" b/s"}const w=g(),{params:i}=w,a=Vue.ref({}),t={},r=Vue.ref(null),c=Vue.ref(null),V=Vue.ref(null),p=Vue.ref(null),v=Vue.ref(null);Vue.watchEffect(()=>{r.value&&c.value&&V.value&&(t.video={bps:new o.TimelineGraphView(r.value),fps:new o.TimelineGraphView(c.value),gop:new o.TimelineGraphView(V.value),bpsds:new o.TimelineDataSeries,fpsds:new o.TimelineDataSeries,gopds:new o.TimelineDataSeries},t.video.bps.addDataSeries(t.video.bpsds),t.video.fps.addDataSeries(t.video.fpsds),t.video.gop.addDataSeries(t.video.gopds))}),Vue.watchEffect(()=>{p.value&&v.value&&(t.audio={bps:new o.TimelineGraphView(p.value),fps:new o.TimelineGraphView(v.value),bpsds:new o.TimelineDataSeries,fpsds:new o.TimelineDataSeries},t.audio.bps.addDataSeries(t.audio.bpsds),t.audio.fps.addDataSeries(t.audio.fpsds))});const _=new MediaStreamTrackGenerator({kind:"video"}),b=_.writable.getWriter(),N=new MediaStream([_]);async function k(){a.value=await T(i.id,i.streamPath.join("/")),a.value.videoTrack&&S(i.id,i.streamPath.join("/")).then(d=>{const l=new VideoDecoder({output:e=>{b.write(e),e.close(),l.close()},error:e=>{h.error(e)}});l.configure({codec:a.value.videoTrack.codec+".420028",avc:{format:"annexb"}}),l.decode(new EncodedVideoChunk({type:"key",data:d,timestamp:0}))}),[a.value.audioTrack,a.value.videoTrack].forEach((d,l)=>{var s,m;const e=l===0?"audio":"video";d&&t[e]&&(t[e].bpsds.addPoint(+new Date,d.bps<<3),t[e].fpsds.addPoint(+new Date,d.fps),(s=t[e].gopds)==null||s.addPoint(+new Date,d.gop),t[e].bps.updateEndDate(),t[e].fps.updateEndDate(),(m=t[e].gop)==null||m.updateEndDate())})}return(u,d)=>{const l=Vue.resolveComponent("n-statistic"),e=Vue.resolveComponent("n-gi"),s=Vue.resolveComponent("n-grid");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(Vue.unref(C),{onTick:k}),Vue.createElementVNode("div",E,[Vue.createVNode(s,{"x-gap":"12",cols:6},{default:Vue.withCtx(()=>[Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("流路径"),value:a.value.path},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"1"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("状态"),value:a.value.state},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"1"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("订阅数"),value:a.value.subscribers},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:a.value.type,value:a.value.meta,"theme-overrides":{valueFontSize:"14px"}},null,8,["label","value"])]),_:1}),a.value.audioTrack?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:0},[Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("音频轨道")+a.value.audioTrack.codec,value:a.value.audioTrack.meta,"theme-overrides":{valueFontSize:"10px"}},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("频率"),value:a.value.audioTrack.sampleRate},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("声道"),value:a.value.audioTrack.channels},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",y,"bps : "+Vue.toDisplayString(f(a.value.audioTrack.bps)),1),Vue.createElementVNode("canvas",{ref_key:"audio_bps",ref:p},null,512)]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",F,"fps : "+Vue.toDisplayString(a.value.audioTrack.fps),1),Vue.createElementVNode("canvas",{ref_key:"audio_fps",ref:v},null,512)]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("漂移"),value:a.value.audioTrack.delta},null,8,["label","value"])]),_:1})],64)):Vue.createCommentVNode("",!0),Vue.createVNode(e,{span:"6"},{default:Vue.withCtx(()=>[B]),_:1}),a.value.videoTrack?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:1},[Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("视频轨道")+a.value.videoTrack.codec,value:a.value.videoTrack.meta,"theme-overrides":{valueFontSize:"10px"}},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("分辨率"),value:a.value.videoTrack.width+"x"+a.value.videoTrack.height},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{label:u.$t("漂移"),value:a.value.videoTrack.delta},null,8,["label","value"])]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",$,"bps : "+Vue.toDisplayString(f(a.value.videoTrack.bps)),1),Vue.createElementVNode("canvas",{ref_key:"video_bps",ref:r},null,512)]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",G,"fps : "+Vue.toDisplayString(a.value.videoTrack.fps),1),Vue.createElementVNode("canvas",{ref_key:"video_fps",ref:c},null,512)]),_:1}),Vue.createVNode(e,{span:"2"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",P,"gop : "+Vue.toDisplayString(a.value.videoTrack.gop),1),Vue.createElementVNode("canvas",{ref_key:"video_gop",ref:V},null,512)]),_:1})],64)):Vue.createCommentVNode("",!0),Vue.createVNode(e,{span:"6",style:{"margin-top":"50px"}},{default:Vue.withCtx(()=>[Vue.createElementVNode("video",{id:"snapshot",srcObject:Vue.unref(N),autoplay:""},null,8,j)]),_:1})]),_:1})])])}}}),W=x(I,[["__scopeId","data-v-74a4cd9b"]]);export{W as default};
