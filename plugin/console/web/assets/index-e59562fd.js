import{m as L,Y as U}from"./vendor-ec30964e.js";import{T as z,B as M}from"./TableAction-09488a2a.js";import{_ as O}from"./index-89b1a529.js";import{i as g,d as j,l as q}from"./index-fa77b114.js";import{x as K,y as Y,z as G,A as H}from"./index-f65e7484.js";function J(r){const t=Vue.ref(!1),c=Vue.ref(null),d=Vue.ref(null);return{loading:t,error:d,result:c,fetchResource:l=>(t.value=!0,r(l).then(V=>{c.value=V}).catch(V=>{d.value=V}).finally(()=>{t.value=!1}))}}function Q(){const{loading:r,error:t,result:c,fetchResource:d}=J(K);return{loading:r,error:t,list:c,fetchResource:d}}const{t:m}=g.global,W=[{title:"ID",key:"id",width:50},{title:m("名称"),key:"name",width:100},{title:"Secret",key:"secret",width:250},{title:m("创建时间"),key:"createtime",width:200},{title:m("状态"),key:"online",width:100,render(r){return Vue.h(naive.NTag,{style:{marginRight:"6px"},type:r.online==1?"success":"error",bordered:!1},{default:()=>r.online==1?m("在线"):m("离线")})}}],ne=Vue.defineComponent({setup(r){const{t}=g.global,c={name:{required:!0,trigger:["blur","input"],message:"请输入名称"}},d=naive.useDialog(),v=Vue.ref(null),l=naive.useMessage(),V=Vue.ref(),F=L(),i=Vue.ref(!1),h=Vue.ref(!1),o=Vue.reactive({name:"",resetSecret:!1}),f=Vue.ref(""),p=Vue.ref({id:"",name:"",mail:"",secret:""}),_=Vue.ref([]),w=Vue.reactive({width:200,title:t("操作"),key:"action",render(e){return Vue.h(z,{style:"button",actions:[{label:t("进入详情"),type:"primary",disabled:e.online!=1,onClick:x.bind(null,e)},{label:t("编辑"),type:"primary",onClick:N.bind(null,e),ifShow:()=>!0},{label:t("删除"),type:"error",icon:"ic:outline-delete-outline",onClick:S.bind(null,e),ifShow:()=>!0}],select:u=>{l.info(`您点击了，${u} 按钮`)}})}});function y(){o.name="",f.value=t("新建实例"),i.value=!0}function b(){const e=F.resolve({name:"instance_dashboard",params:{id:0}});location.href=e.href}async function C(){const{list:n,error:a,fetchResource:B}=Q();await B({pagesize:0,pageno:0}),a.value?l.info(`error--${a.value}`):_.value=n.value.data.list}function D(e){console.log(e)}function E(e){e.preventDefault(),h.value=!0,v.value.validate(u=>{if(u)l.error("请填写完整信息");else if(f.value==t("新建实例")){const n=o.name;G({name:n}).then(()=>{l.success("新建成功"),i.value=!1,C()})}else if(f.value==t("编辑实例")){const n=p.value.id;H({id:n,...o}).then(()=>{l.success("编辑成功"),i.value=!1,C()})}h.value=!1})}function N(e){o.name=e.name,f.value=t("编辑实例"),i.value=!0,p.value.id=e.id,p.value.name=e.name,p.value.mail=localStorage.getItem("mail")||""}function x(e){const u=e.id,n=F.resolve({name:"instance_dashboard",params:{id:u}}),{isSaas:a}=j();a.value?window.open(n.href,"_blank"):location.href=n.href}function S(e){d.warning({title:t("提示"),content:t("您确定要删除此实例吗"),positiveText:t("确定"),negativeText:t("取消"),onPositiveClick:()=>{Y({id:e.id}).then(()=>{l.success(t("删除成功"))})},onNegativeClick:()=>{}})}return(e,u)=>{const n=Vue.resolveComponent("n-icon"),a=Vue.resolveComponent("n-button"),B=Vue.resolveComponent("PlusOutlined"),A=Vue.resolveComponent("n-input"),k=Vue.resolveComponent("n-form-item"),T=Vue.resolveComponent("n-checkbox"),R=Vue.resolveComponent("n-form"),$=Vue.resolveComponent("n-space"),I=Vue.resolveComponent("n-modal"),P=Vue.resolveComponent("n-card");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(Vue.unref(O),{onTick:C}),Vue.createVNode(P,{bordered:!1,class:"proCard"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(M),{columns:Vue.unref(W),dataSource:_.value,"row-key":s=>s.id,pagination:!1,ref_key:"actionRef",ref:V,actionColumn:Vue.unref(w),"onUpdate:checkedRowKeys":D,"scroll-x":1090},{tableTitle:Vue.withCtx(()=>[Vue.unref(q)?(Vue.openBlock(),Vue.createBlock(a,{key:0,type:"primary",onClick:b},{icon:Vue.withCtx(()=>[Vue.createVNode(n,null,{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(U))]),_:1})]),default:Vue.withCtx(()=>[Vue.createTextVNode(" "+Vue.toDisplayString(e.$t("进入当前实例")),1)]),_:1})):(Vue.openBlock(),Vue.createBlock(a,{key:1,type:"primary",onClick:y},{icon:Vue.withCtx(()=>[Vue.createVNode(n,null,{default:Vue.withCtx(()=>[Vue.createVNode(B)]),_:1})]),default:Vue.withCtx(()=>[Vue.createTextVNode(" "+Vue.toDisplayString(e.$t("新建")),1)]),_:1}))]),_:1},8,["columns","dataSource","row-key","actionColumn"]),Vue.createVNode(I,{show:i.value,"onUpdate:show":u[3]||(u[3]=s=>i.value=s),"show-icon":!1,preset:"dialog",title:f.value},{action:Vue.withCtx(()=>[Vue.createVNode($,null,{default:Vue.withCtx(()=>[Vue.createVNode(a,{onClick:u[2]||(u[2]=()=>i.value=!1)},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(e.$t("取消")),1)]),_:1}),Vue.createVNode(a,{type:"info",loading:h.value,onClick:E},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(e.$t("确定")),1)]),_:1},8,["loading"])]),_:1})]),default:Vue.withCtx(()=>[Vue.createVNode(R,{model:Vue.unref(o),rules:c,ref_key:"formRef",ref:v,"label-placement":"left","label-width":85,class:"py-4"},{default:Vue.withCtx(()=>[Vue.createVNode(k,{label:e.$t("名称"),path:"name"},{default:Vue.withCtx(()=>[Vue.createVNode(A,{placeholder:e.$t("请输入实例名称"),value:Vue.unref(o).name,"onUpdate:value":u[0]||(u[0]=s=>Vue.unref(o).name=s)},null,8,["placeholder","value"])]),_:1},8,["label"]),f.value==e.$t("编辑实例")?(Vue.openBlock(),Vue.createBlock(k,{key:0,label:e.$t("重置")+" secret",path:"resetSecret"},{default:Vue.withCtx(()=>[Vue.createVNode(T,{checked:Vue.unref(o).resetSecret,"onUpdate:checked":u[1]||(u[1]=s=>Vue.unref(o).resetSecret=s)},null,8,["checked"])]),_:1},8,["label"])):Vue.createCommentVNode("",!0)]),_:1},8,["model"])]),_:1},8,["show","title"])]),_:1})])}}});export{ne as default};
